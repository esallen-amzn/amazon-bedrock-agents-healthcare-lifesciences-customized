# Line Endings Checker

## Overview

The Line Endings Checker detects files with Windows line endings (CRLF) and provides commands to convert them to Unix line endings (LF), which are required for proper execution on macOS.

## Requirements Addressed

- **Requirement 1.2**: Detect any files with Windows line endings (CRLF)

## What It Checks

The checker scans the following file types:

### Critical (Must have LF)
- `.sh` - Shell scripts
- `.py` - Python files

### Warning (Should have LF)
- `.yaml`, `.yml` - Configuration files
- `.json` - JSON configuration files
- `.txt` - Text files
- `.md` - Markdown documentation

## How It Works

1. **File Discovery**: Recursively scans the project for relevant file types
2. **Line Ending Detection**: Reads files in binary mode to detect:
   - CRLF (`\r\n`) - Windows line endings
   - LF (`\n`) - Unix/Mac line endings
   - CR (`\r`) - Old Mac line endings (rare)
   - MIXED - Files with both CRLF and LF
3. **Issue Reporting**: Reports files with Windows line endings
4. **Fix Generation**: Provides commands to convert line endings

## Usage

### Standalone Usage

```python
from checkers.line_endings_checker import LineEndingsChecker

# Create checker
checker = LineEndingsChecker('/path/to/project')

# Run check
result = checker.check()

# Display results
print(f"Status: {result.status}")
print(f"Files checked: {result.files_checked}")
print(f"Issues found: {len(result.issues)}")

# Get fix script
fix_script = checker.get_fix_script()
print(fix_script)
```

### Integrated Usage

```python
from test_migration import MigrationTester
from checkers import LineEndingsChecker

# Create tester
tester = MigrationTester('/path/to/project')

# Register checker
checker = LineEndingsChecker('/path/to/project')
tester.register_checker(checker)

# Run all checks
report = tester.run_all_checks()
```

### Command Line

```bash
# Run standalone test
python test_line_endings_checker.py

# Run integration test
python test_line_endings_integration.py

# Run full migration test (when integrated)
python test_migration.py /path/to/project
```

## Fix Commands

The checker generates two types of fix commands:

### Using dos2unix (Recommended)
```bash
dos2unix path/to/file.sh
```

### Using sed (Fallback)
```bash
sed -i '' 's/\r$//' path/to/file.sh
```

The generated fix script automatically detects which tool is available and uses the appropriate command.

## Output Format

### Issue Object
```python
LineEndingIssue(
    file_path="scripts/deploy.sh",
    line_ending_type="CRLF",
    total_lines=45,
    crlf_count=45,
    fix_command="dos2unix scripts/deploy.sh || sed -i '' 's/\\r$//' scripts/deploy.sh",
    severity="CRITICAL"
)
```

### Result Object
```python
LineEndingsCheckResult(
    status="FAIL",  # PASS, FAIL, WARNING
    issues=[...],
    files_checked=98,
    message="Found 5 critical files with Windows line endings (CRLF)"
)
```

## Severity Levels

- **CRITICAL**: Shell scripts (`.sh`) and Python files (`.py`) with CRLF
  - Impact: Scripts may fail to execute on macOS
  - Action: Must be fixed before deployment

- **WARNING**: Configuration and documentation files with CRLF
  - Impact: May cause parsing issues or inconsistencies
  - Action: Should be fixed for consistency

## Exclusions

The checker automatically skips:
- Hidden directories (except `.kiro`)
- `__pycache__` directories
- `node_modules` directories
- Virtual environments (`venv`, `.venv`)
- Build directories (`build`, `dist`)
- `.git` directory

## Generated Fix Script

The checker can generate a complete fix script:

```bash
#!/bin/bash
#
# Auto-generated script to fix line endings
# Generated by Windows-to-Mac migration checker
#

set -e  # Exit on error

echo 'Fixing line endings (CRLF -> LF)...'

# Check if dos2unix is available
if command -v dos2unix &> /dev/null; then
    echo 'Using dos2unix for conversion'
    USE_DOS2UNIX=true
else
    echo 'dos2unix not found, using sed for conversion'
    USE_DOS2UNIX=false
fi

echo 'Fixing: scripts/deploy.sh'
if [ "$USE_DOS2UNIX" = true ]; then
    dos2unix scripts/deploy.sh
else
    sed -i '' 's/\r$//' scripts/deploy.sh
fi

echo 'All line endings fixed successfully!'
```

## Testing

Run the test suite to verify the checker:

```bash
# Test the checker implementation
python test_line_endings_checker.py

# Test integration with migration framework
python test_line_endings_integration.py
```

## Notes

- The checker reads files in binary mode to accurately detect line endings
- Files that cannot be read (permissions, binary files) are skipped
- The fix commands are safe and can be run multiple times
- Converting line endings does not modify file content, only line ending characters
